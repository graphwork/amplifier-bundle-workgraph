# Amplifier Executor for Workgraph
#
# Install: copy to .workgraph/executors/amplifier.toml
# Or run:  ./install.sh from this directory
#
# Set as default: wg config --coordinator-executor amplifier

[executor]
# type = "claude" makes workgraph generate: cat prompt.txt | command
# This is how workgraph pipes the rendered prompt to our wrapper script.
# For non-claude types, stdin is null and no prompt is passed.
type = "claude"
command = ".workgraph/executors/amplifier-run.sh"
args = ["--bundle", "workgraph"]
working_dir = "{{working_dir}}"
timeout = 600

[executor.env]
WG_TASK_ID = "{{task_id}}"

[executor.prompt_template]
template = """
{{task_identity}}

# Task Assignment

**Task ID**: `{{task_id}}`
**Title**: {{task_title}}

## Description

{{task_description}}

## Context from Completed Dependencies

{{task_context}}

## Workgraph Protocol

You are running as a workgraph executor. Follow this protocol exactly:

### During Work

Log progress regularly:
```
wg log {{task_id}} "description of what you're doing"
```

Record any files you create or significantly modify:
```
wg artifact {{task_id}} path/to/file
```

### On Completion

When your work is done and verified:
```
wg done {{task_id}}
```

### On Failure

If you cannot complete the task:
```
wg fail {{task_id}} --reason "specific reason"
```

## Rules

1. Focus on THIS task only -- do not modify the task graph or claim other tasks
2. Log progress at least every few minutes so the project has visibility
3. Record all artifacts so downstream tasks know what you produced
4. Read `wg context {{task_id}}` if you need more detail from upstream work
5. Always mark done or fail before finishing -- never exit silently
6. Use `wg show {{task_id}}` to review the full task details and acceptance criteria

Work carefully, test your changes, and mark done when complete.
"""
